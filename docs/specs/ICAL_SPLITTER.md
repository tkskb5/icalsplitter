# iCAL分割Webサービス

## 概要

大容量のiCAL（.ics）ファイルを、Googleカレンダーなどのサービスにインポート可能なサイズに分割するWebサービス。

### 背景
- Googleカレンダーのインポート制限（約3MB）を超える古いカレンダーデータの移行時に問題が発生
- ファイルを手動で分割するのは、iCALフォーマットの複雑さ（VCALENDARヘッダ/フッタ、VEVENTの整合性）から困難

---

## ユーザーストーリー

> **As a** Googleカレンダーユーザー  
> **I want to** 大容量のiCALファイルを適切なサイズに分割したい  
> **So that** 新しいGoogleアカウントにカレンダーデータを移行できる

---

## 機能要件

### 1. ファイルアップロード
- ドラッグ&ドロップまたはファイル選択でiCALファイルをアップロード
- クライアントサイドで処理（サーバーにファイルを送信しない、プライバシー配慮）

### 2. ファイル解析・プレビュー
- **統計情報表示**：
  - ファイルサイズ（KB/MB）
  - イベント総数
  - 期間（最古のイベント〜最新のイベント）
  - 年別のイベント数分布

### 3. 分割オプション

#### 3.1 期間で分割
- 開始日・終了日を指定して特定期間のイベントのみ抽出
- 例：「2020年以前のイベントを削除」「2023年のイベントのみ抽出」

#### 3.2 サイズで分割
- 目標ファイルサイズを指定（例：500KB）
- 自動的に複数ファイルに分割
- 各ファイルが有効なiCAL形式を維持

#### 3.3 年別で分割
- 年ごとにファイルを自動分割
- 例：`calendar_2020.ics`, `calendar_2021.ics`, ...

### 4. ダウンロード
- 分割後のファイルを個別または一括（ZIP）でダウンロード
- ファイル名に分割条件を含める（例：`calendar_2020-2022.ics`）

---

## 技術設計

### アーキテクチャ
**クライアントサイドSPA（Single Page Application）**
- 完全にブラウザ内で処理
- サーバーへのファイルアップロード不要（プライバシー保護）
- 静的ホスティングで運用可能

### 技術スタック
| 項目 | 選択 | 理由 |
|------|------|------|
| フレームワーク | Vanilla HTML/CSS/JS | シンプル、依存性なし |
| iCALパース | 自前実装 | RFC 5545準拠、軽量 |
| ZIP生成 | JSZip | 一括ダウンロード用 |
| ホスティング | GitHub Pages / Netlify | 無料、静的サイト |

### ファイル構成（予定）
```
/
├── index.html          # メインページ
├── css/
│   └── style.css       # スタイル
├── js/
│   ├── app.js          # メインロジック
│   ├── ical-parser.js  # iCAL解析
│   └── ical-writer.js  # iCAL書き出し
└── docs/
    └── specs/          # 仕様書
```

### iCALフォーマット（RFC 5545）

```ics
BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//Example//Example//EN
BEGIN:VEVENT
UID:unique-id@example.com
DTSTAMP:20240101T120000Z
DTSTART:20240115T090000Z
DTEND:20240115T100000Z
SUMMARY:会議
END:VEVENT
END:VCALENDAR
```

**分割時の注意点**：
- 各分割ファイルに `BEGIN:VCALENDAR` / `END:VCALENDAR` ヘッダ/フッタを付与
- `VERSION`, `PRODID` などのカレンダーメタデータを保持
- VEVENTを途中で切らない（イベント単位で分割）

---

## UI設計方針

### 画面フロー
```
[アップロード] → [解析・プレビュー] → [分割設定] → [ダウンロード]
```

### デザイン方針
- モダンでクリーンなUI（ダークモード対応）
- ステップバイステップの分かりやすいフロー
- ファイルサイズのリアルタイム表示

---

## 類似サービス・参考資料

1. **RFC 5545** - iCalendar仕様
2. **icalendar (Python)** - パース実装の参考
3. **node-ical (Node.js)** - JavaScript実装の参考

---

## 検証方法

### ユニットテスト
- iCALパーサーの単体テスト
- 分割ロジックのテスト（境界条件含む）

### 統合テスト
1. サンプルiCALファイル（大容量）を用意
2. 分割実行
3. 分割後の各ファイルがGoogleカレンダーにインポート可能か確認

### ブラウザテスト
- Chrome, Safari, Firefoxで動作確認
- ドラッグ&ドロップの動作確認

---

## 今後の拡張案（Phase 2）

- [ ] 重複イベントの検出・削除機能
- [ ] 特定キーワードでのフィルタリング
- [ ] 繰り返しイベント（RRULE）の展開オプション
- [ ] Outlookカレンダー形式対応

---

## 質問事項

1. **ホスティング先**：GitHub Pages、Netlify、Vercel等のご希望はありますか？
2. **多言語対応**：日本語のみで良いですか？
3. **ファイルサイズ上限**：ブラウザ処理の上限として何MBまで対応しますか？（推奨：50MB程度）
